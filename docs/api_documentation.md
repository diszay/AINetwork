# NetArchon API Documentation

## What is the NetArchon API?

**For Everyone:**
The NetArchon API is like a "remote control" for your network monitoring system. It allows other programs and tools to get information from NetArchon or control it automatically. Think of it like how your TV remote can change channels - the API lets other software "change channels" on your network monitoring.

**For Developers:**
NetArchon provides a comprehensive RESTful API for programmatic access to network monitoring data, device management, and system configuration. The API is designed for integration with external systems, automation tools, and custom applications, enabling you to build custom dashboards, automated responses, and third-party integrations.\n\n## Base URL\n\n```\nhttp://<server-ip>:5000/api/v1\n```\n\n## Authentication\n\nThe API uses token-based authentication. Include the authentication token in the `Authorization` header:\n\n```\nAuthorization: Bearer <your-token>\n```\n\n### Obtaining an API Token\n\n```bash\ncurl -X POST http://<server-ip>:5000/api/v1/auth/token \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\": \"your-username\", \"password\": \"your-password\"}'\n```\n\n## Endpoints\n\n### Network Overview\n\n#### Get Network Status\n\n```http\nGET /network/status\n```\n\nReturns overall network health and device connectivity status.\n\n**Response:**\n```json\n{\n  \"network_health\": 95.5,\n  \"total_devices\": 12,\n  \"online_devices\": 11,\n  \"offline_devices\": 1,\n  \"last_updated\": \"2025-01-22T10:30:00Z\"\n}\n```\n\n#### Get Network Topology\n\n```http\nGET /network/topology\n```\n\nReturns the current network topology with device relationships.\n\n**Response:**\n```json\n{\n  \"nodes\": [\n    {\n      \"id\": \"xfinity_gateway\",\n      \"name\": \"Xfinity Gateway\",\n      \"type\": \"gateway\",\n      \"ip_address\": \"192.168.1.1\",\n      \"status\": \"online\"\n    }\n  ],\n  \"edges\": [\n    {\n      \"source\": \"xfinity_gateway\",\n      \"target\": \"arris_s33\",\n      \"connection_type\": \"ethernet\"\n    }\n  ]\n}\n```\n\n### Device Management\n\n#### List All Devices\n\n```http\nGET /devices\n```\n\nReturns a list of all monitored devices.\n\n**Query Parameters:**\n- `status` (optional): Filter by device status (`online`, `offline`)\n- `type` (optional): Filter by device type\n- `limit` (optional): Limit number of results (default: 100)\n- `offset` (optional): Offset for pagination (default: 0)\n\n**Response:**\n```json\n{\n  \"devices\": [\n    {\n      \"device_id\": \"xfinity_gateway\",\n      \"device_name\": \"Xfinity Gateway\",\n      \"device_type\": \"xfinity_gateway\",\n      \"ip_address\": \"192.168.1.1\",\n      \"status\": \"online\",\n      \"last_seen\": \"2025-01-22T10:29:45Z\",\n      \"uptime_percentage\": 99.8\n    }\n  ],\n  \"total\": 12,\n  \"limit\": 100,\n  \"offset\": 0\n}\n```\n\n#### Get Device Details\n\n```http\nGET /devices/{device_id}\n```\n\nReturns detailed information about a specific device.\n\n**Response:**\n```json\n{\n  \"device_id\": \"arris_s33\",\n  \"device_name\": \"Arris Surfboard S33\",\n  \"device_type\": \"arris_s33_modem\",\n  \"ip_address\": \"192.168.100.1\",\n  \"status\": \"online\",\n  \"last_seen\": \"2025-01-22T10:29:30Z\",\n  \"uptime_percentage\": 99.9,\n  \"metrics\": {\n    \"snr_downstream\": 42.5,\n    \"snr_upstream\": 38.2,\n    \"power_downstream\": -2.1,\n    \"power_upstream\": 45.3\n  },\n  \"alerts\": [\n    {\n      \"alert_id\": \"alert_123\",\n      \"severity\": \"warning\",\n      \"message\": \"Upstream power level approaching threshold\",\n      \"timestamp\": \"2025-01-22T10:15:00Z\"\n    }\n  ]\n}\n```\n\n#### Update Device Configuration\n\n```http\nPUT /devices/{device_id}\n```\n\nUpdates device configuration settings.\n\n**Request Body:**\n```json\n{\n  \"device_name\": \"Updated Device Name\",\n  \"collection_interval\": 120,\n  \"enabled\": true\n}\n```\n\n### Metrics\n\n#### Get Device Metrics\n\n```http\nGET /devices/{device_id}/metrics\n```\n\nReturns metrics data for a specific device.\n\n**Query Parameters:**\n- `metric_type` (optional): Filter by metric type\n- `metric_name` (optional): Filter by specific metric name\n- `start_time` (optional): Start time for data range (ISO 8601)\n- `end_time` (optional): End time for data range (ISO 8601)\n- `limit` (optional): Limit number of results (default: 1000)\n\n**Response:**\n```json\n{\n  \"metrics\": [\n    {\n      \"timestamp\": \"2025-01-22T10:29:00Z\",\n      \"metric_type\": \"system_resources\",\n      \"metric_name\": \"cpu_usage\",\n      \"value\": 45.2,\n      \"unit\": \"percent\"\n    }\n  ],\n  \"total\": 1000,\n  \"device_id\": \"mini_pc_server\"\n}\n```\n\n#### Get Aggregated Metrics\n\n```http\nGET /metrics/aggregate\n```\n\nReturns aggregated metrics across all devices or filtered devices.\n\n**Query Parameters:**\n- `device_ids` (optional): Comma-separated list of device IDs\n- `metric_type` (optional): Filter by metric type\n- `aggregation` (required): Aggregation method (`avg`, `min`, `max`, `sum`)\n- `interval` (optional): Time interval for aggregation (`1m`, `5m`, `1h`, `1d`)\n- `start_time` (optional): Start time for data range\n- `end_time` (optional): End time for data range\n\n### Alerts\n\n#### List Active Alerts\n\n```http\nGET /alerts\n```\n\nReturns a list of active alerts.\n\n**Query Parameters:**\n- `severity` (optional): Filter by severity (`critical`, `warning`, `info`)\n- `device_id` (optional): Filter by device ID\n- `status` (optional): Filter by status (`active`, `acknowledged`, `resolved`)\n- `limit` (optional): Limit number of results\n- `offset` (optional): Offset for pagination\n\n**Response:**\n```json\n{\n  \"alerts\": [\n    {\n      \"alert_id\": \"alert_123\",\n      \"rule_id\": \"high_cpu_usage\",\n      \"device_id\": \"mini_pc_server\",\n      \"severity\": \"warning\",\n      \"status\": \"active\",\n      \"message\": \"CPU usage is 87% (threshold: 85%)\",\n      \"first_triggered\": \"2025-01-22T10:15:00Z\",\n      \"last_triggered\": \"2025-01-22T10:29:00Z\",\n      \"trigger_count\": 5\n    }\n  ],\n  \"total\": 3,\n  \"limit\": 100,\n  \"offset\": 0\n}\n```\n\n#### Acknowledge Alert\n\n```http\nPOST /alerts/{alert_id}/acknowledge\n```\n\nAcknowledges an active alert.\n\n**Request Body:**\n```json\n{\n  \"acknowledged_by\": \"admin\",\n  \"note\": \"Investigating high CPU usage\"\n}\n```\n\n#### Resolve Alert\n\n```http\nPOST /alerts/{alert_id}/resolve\n```\n\nMarks an alert as resolved.\n\n**Request Body:**\n```json\n{\n  \"resolved_by\": \"admin\",\n  \"resolution_note\": \"CPU usage returned to normal after service restart\"\n}\n```\n\n### Alert Rules\n\n#### List Alert Rules\n\n```http\nGET /alert-rules\n```\n\nReturns a list of configured alert rules.\n\n#### Create Alert Rule\n\n```http\nPOST /alert-rules\n```\n\nCreates a new alert rule.\n\n**Request Body:**\n```json\n{\n  \"name\": \"High Memory Usage\",\n  \"description\": \"Alert when memory usage exceeds threshold\",\n  \"device_filter\": [\"mini_pc_server\"],\n  \"metric_type_filter\": [\"system_resources\"],\n  \"metric_name_filter\": [\"memory_usage\"],\n  \"operator\": \"greater_than\",\n  \"threshold_value\": 90.0,\n  \"severity\": \"critical\",\n  \"evaluation_window_minutes\": 5,\n  \"consecutive_breaches_required\": 2,\n  \"notification_channels\": [\"email\", \"slack\"]\n}\n```\n\n### Configuration\n\n#### Get System Configuration\n\n```http\nGET /config\n```\n\nReturns current system configuration (sensitive values masked).\n\n#### Update Configuration\n\n```http\nPUT /config\n```\n\nUpdates system configuration.\n\n**Request Body:**\n```json\n{\n  \"collection\": {\n    \"default_interval\": 60,\n    \"max_concurrent\": 10\n  },\n  \"alerts\": {\n    \"thresholds\": {\n      \"cpu_usage_warning\": 80.0,\n      \"cpu_usage_critical\": 90.0\n    }\n  }\n}\n```\n\n### System Status\n\n#### Get System Health\n\n```http\nGET /system/health\n```\n\nReturns system health information.\n\n**Response:**\n```json\n{\n  \"status\": \"healthy\",\n  \"uptime\": 86400,\n  \"version\": \"1.0.0\",\n  \"components\": {\n    \"collector\": \"running\",\n    \"alerts\": \"running\",\n    \"web\": \"running\",\n    \"database\": \"connected\"\n  },\n  \"resource_usage\": {\n    \"cpu_percent\": 15.2,\n    \"memory_percent\": 45.8,\n    \"disk_percent\": 23.1\n  }\n}\n```\n\n#### Get System Statistics\n\n```http\nGET /system/stats\n```\n\nReturns system statistics and performance metrics.\n\n## WebSocket API\n\nNetArchon provides real-time data streaming via WebSocket connections.\n\n### Connection\n\n```javascript\nconst ws = new WebSocket('ws://<server-ip>:5000/ws');\n```\n\n### Subscribing to Real-time Data\n\nSend subscription messages to receive real-time updates:\n\n```javascript\n// Subscribe to device metrics\nws.send(JSON.stringify({\n  \"type\": \"subscribe\",\n  \"channel\": \"metrics\",\n  \"device_id\": \"mini_pc_server\",\n  \"metric_types\": [\"system_resources\"]\n}));\n\n// Subscribe to alerts\nws.send(JSON.stringify({\n  \"type\": \"subscribe\",\n  \"channel\": \"alerts\",\n  \"severity\": [\"critical\", \"warning\"]\n}));\n```\n\n### Message Format\n\nReal-time messages follow this format:\n\n```javascript\n{\n  \"channel\": \"metrics\",\n  \"timestamp\": \"2025-01-22T10:30:00Z\",\n  \"data\": {\n    \"device_id\": \"mini_pc_server\",\n    \"metric_type\": \"system_resources\",\n    \"metric_name\": \"cpu_usage\",\n    \"value\": 42.1,\n    \"unit\": \"percent\"\n  }\n}\n```\n\n## Error Handling\n\nThe API uses standard HTTP status codes and returns error details in JSON format:\n\n```json\n{\n  \"error\": {\n    \"code\": \"DEVICE_NOT_FOUND\",\n    \"message\": \"Device with ID 'invalid_device' not found\",\n    \"details\": {\n      \"device_id\": \"invalid_device\"\n    }\n  }\n}\n```\n\n### Common Error Codes\n\n- `400 Bad Request`: Invalid request parameters\n- `401 Unauthorized`: Missing or invalid authentication token\n- `403 Forbidden`: Insufficient permissions\n- `404 Not Found`: Resource not found\n- `429 Too Many Requests`: Rate limit exceeded\n- `500 Internal Server Error`: Server error\n\n## Rate Limiting\n\nThe API implements rate limiting to prevent abuse:\n\n- **Standard endpoints**: 100 requests per minute per IP\n- **Metrics endpoints**: 1000 requests per minute per IP\n- **WebSocket connections**: 10 concurrent connections per IP\n\nRate limit headers are included in responses:\n\n```\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 95\nX-RateLimit-Reset: 1642857600\n```\n\n## SDK and Examples\n\n### Python SDK\n\n```python\nimport requests\nfrom netarchon_sdk import NetArchonClient\n\n# Initialize client\nclient = NetArchonClient(\n    base_url=\"http://192.168.1.100:5000\",\n    token=\"your-api-token\"\n)\n\n# Get network status\nstatus = client.network.get_status()\nprint(f\"Network health: {status['network_health']}%\")\n\n# Get device metrics\nmetrics = client.devices.get_metrics(\n    device_id=\"mini_pc_server\",\n    metric_type=\"system_resources\",\n    start_time=\"2025-01-22T00:00:00Z\"\n)\n\n# Create alert rule\nrule = client.alerts.create_rule({\n    \"name\": \"High Disk Usage\",\n    \"metric_name_filter\": [\"disk_usage\"],\n    \"operator\": \"greater_than\",\n    \"threshold_value\": 85.0,\n    \"severity\": \"warning\"\n})\n```\n\n### JavaScript/Node.js Example\n\n```javascript\nconst axios = require('axios');\n\nclass NetArchonAPI {\n    constructor(baseURL, token) {\n        this.client = axios.create({\n            baseURL: baseURL,\n            headers: {\n                'Authorization': `Bearer ${token}`,\n                'Content-Type': 'application/json'\n            }\n        });\n    }\n\n    async getNetworkStatus() {\n        const response = await this.client.get('/network/status');\n        return response.data;\n    }\n\n    async getDeviceMetrics(deviceId, options = {}) {\n        const response = await this.client.get(`/devices/${deviceId}/metrics`, {\n            params: options\n        });\n        return response.data;\n    }\n}\n\n// Usage\nconst api = new NetArchonAPI('http://192.168.1.100:5000/api/v1', 'your-token');\n\napi.getNetworkStatus().then(status => {\n    console.log(`Network health: ${status.network_health}%`);\n});\n```\n\n### cURL Examples\n\n```bash\n# Get network status\ncurl -H \"Authorization: Bearer your-token\" \\\n     http://192.168.1.100:5000/api/v1/network/status\n\n# Get device metrics with time range\ncurl -H \"Authorization: Bearer your-token\" \\\n     \"http://192.168.1.100:5000/api/v1/devices/mini_pc_server/metrics?start_time=2025-01-22T00:00:00Z&metric_type=system_resources\"\n\n# Create alert rule\ncurl -X POST \\\n     -H \"Authorization: Bearer your-token\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\n       \"name\": \"High CPU Alert\",\n       \"metric_name_filter\": [\"cpu_usage\"],\n       \"operator\": \"greater_than\",\n       \"threshold_value\": 85.0,\n       \"severity\": \"warning\"\n     }' \\\n     http://192.168.1.100:5000/api/v1/alert-rules\n```\n\n## Changelog\n\n### Version 1.0.0\n- Initial API release\n- Basic device and metrics endpoints\n- Alert management functionality\n- WebSocket support for real-time data\n\n## Support\n\nFor API support and questions:\n\n- Documentation: [https://docs.netarchon.com/api](https://docs.netarchon.com/api)\n- GitHub Issues: [https://github.com/yourusername/netarchon/issues](https://github.com/yourusername/netarchon/issues)\n- Community Forum: [https://community.netarchon.com](https://community.netarchon.com)"